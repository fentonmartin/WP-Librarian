var notificationCount=0;var WP_LIB_NONCE='wp_lib_ajax_nonce';wp_lib_vars.onClick='wp_lib_click_button(this)';jQuery(function($){window.notificationHolder=jQuery('#wp-lib-notifications');});function wp_lib_collect_form_params(clickedElement){var objects=jQuery(clickedElement).closest('form').serializeArray();var result={};objects.forEach(function(object){if(object.hasOwnProperty('name')&&object.hasOwnProperty('value')&&object.value!=''){result[object.name]=object.value;}});return result;}
function wp_lib_add_notification(array){if(typeof window.wp_lib_notification_buffer==='undefined'){window.wp_lib_notification_buffer=[];}
window.wp_lib_notification_buffer.push(array);}
function wp_lib_fetch_local_notifications(){if(typeof window.wp_lib_notification_buffer!='undefined'){var notifications=window.wp_lib_notification_buffer;delete window.wp_lib_notification_buffer;return notifications;}
return[];}
function wp_lib_display_local_notifications(){wp_lib_render_notifications(wp_lib_fetch_local_notifications());}
function wp_lib_render_notifications(notificationsArray){notificationsArray.forEach(function(notificationText){wp_lib_render_notification(notificationText);});}
function wp_lib_render_notification(notificationText){var result=wp_lib_format_notification(notificationText);if(notificationText[0]!=0&&typeof console!=='undefined'){console.log(result[2]);}
notificationHolder.append(result[1]).hide().fadeIn(500);var notification=jQuery('.'+result[0]);var displayTime=notificationText[1].length*150;if(displayTime<3500){displayTime=3500;}else if(displayTime>7000){displayTime=9000;}
setTimeout(function(){wp_lib_hide_notification(notification);},displayTime);}
function wp_lib_local_notification(text){wp_lib_render_notification([0,text]);}
function wp_lib_local_error(text){wp_lib_render_notification([1,text]);}
function wp_lib_format_notification(notification){var uID='wp_lib_nid_'+notificationCount++;var classes=uID+' ';var message='';var consoleMessage='';if(notification[0]==0){classes+='wp-lib-notification updated';message=notification[1];}else if(notification[0]==1){classes+='wp-lib-error error';consoleMessage='WP-Librarian Error: '+notification[1];message='<strong style="color: red;">'+consoleMessage+'</strong>';}else{classes+='wp-lib-error error';consoleMessage='WP-Librarian Error '+notification[0]+': '+notification[1];message='<strong style="color: red;">'+consoleMessage+'</strong>';}
return[uID,'<div onclick="wp_lib_hide_notification(this)" class="'+classes+'"><p>'+message+'</p></div>',consoleMessage];}
function wp_lib_hide_notification(element){var notification=jQuery(element);notification.fadeOut("fast");notification.remove();}
function wp_lib_click_button(e){location.href=jQuery(e).attr('href');}
function wp_lib_parse_json(rawJSON){try{var parsedJSON=JSON.parse(rawJSON);}
catch(e){wp_lib_local_error("Server returned invalid response");if(wp_lib_vars.debugMode==='1'){jQuery('<div/>',{'style':'background:grey;','html':'<strong style="color:red;">Server Response</strong></br/>'+rawJSON}).appendTo('#wp-lib-workspace');}
parsedJSON=0;}
return parsedJSON;}
function wp_lib_send_ajax(ajaxData,postCallFunction){var outputBuffer=[];jQuery.post(ajaxurl,ajaxData).done(function(response){if(response==='0'){wp_lib_local_error("WordPress rejected AJAX request. This is likely a permissions issue.");outputBuffer[0]=1;return;}else{var ajaxResult=wp_lib_parse_json(response);if(ajaxResult===0||!(ajaxResult instanceof Array)){outputBuffer[0]=2;}else{if(ajaxResult[0]===true){outputBuffer=[4,ajaxResult];}else{outputBuffer=[3,ajaxResult];}}}}).fail(function(data,a,message){if(data.status===0){wp_lib_local_error('Unable to connect to '+wp_lib_vars.siteName+'. Check your internet connection.');}else{wp_lib_local_error('HTTP Error '+data.status+': '+message);}
if(wp_lib_vars.debugMode){if(data.responseText!=''){console.log(jQuery(data.responseText).text());}}else{console.log('Please temporarily enable debugging mode to investigate the error https://github.com/kittsville/WP-Librarian/wiki/wp_lib_debug_mode');console.log("Unless it's an HTTP error that has nothing to do with WP-Librarian");}
outputBuffer[0]=0;}).always(function(){if(typeof postCallFunction==='function'){postCallFunction(outputBuffer);}
var notifications=wp_lib_fetch_local_notifications();if(outputBuffer[0]>=3){notifications=notifications.concat(outputBuffer[1][1]);}
wp_lib_render_notifications(notifications);});}
function wp_lib_init_object(pageItem){elementObject={};jQuery(['id','name','value','html','title','href']).each(function(i,e){if(e in pageItem){elementObject[e]=pageItem[e];}});return elementObject;}
