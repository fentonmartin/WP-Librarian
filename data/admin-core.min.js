var wp_lib_scripts={};wp_lib_vars.onClick='wp_lib_click_button(this)';function wp_lib_collect_form_params(clickedElement){var objects=jQuery(clickedElement).closest('form').serializeArray();var result={};objects.forEach(function(object){if(object.hasOwnProperty('name')&&object.hasOwnProperty('value')&&object.value!=''){result[object.name]=object.value;}});return result;}
function wp_lib_get_script(scriptURL){jQuery.ajax({dataType:'script',cache:!wp_lib_vars.debugMode,url:scriptURL}).fail(function(jqxhr,settings,exception){wp_lib_error("Failed to load JavaScript needed for this page");console.log('Script URL: '+scriptURL);console.log(exception);}).success(function(){var moduleName=scriptURL.match(/.*\/(.+?)\./)[1];if(wp_lib_scripts.hasOwnProperty(moduleName)&&wp_lib_scripts[moduleName].init instanceof Object){wp_lib_scripts[moduleName].init();}});}
function wp_lib_notification(message){wp_lib_scripts.Notifications.displayNotification([0,message]);}
function wp_lib_error(message){wp_lib_scripts.Notifications.displayNotification([1,message]);}
function wp_lib_click_button(e){location.href=jQuery(e).attr('href');}
function wp_lib_parse_json(rawJSON){try{var parsedJSON=JSON.parse(rawJSON);}
catch(e){wp_lib_error("Server returned invalid response");if(wp_lib_vars.debugMode==='1'){jQuery('<div/>',{'style':'background:grey;','html':'<strong style="color:red;">Server Response</strong></br/>'+rawJSON}).appendTo('#wp-lib-workspace');}
parsedJSON=0;}
return parsedJSON;}
function wp_lib_send_ajax(ajaxData,postCallFunction){var outputBuffer=[];jQuery.post(ajaxurl,ajaxData).done(function(response){if(response==='0'){wp_lib_error("WordPress rejected AJAX request. This is likely a permissions issue.");outputBuffer[0]=1;return;}else{var ajaxResult=wp_lib_parse_json(response);if(ajaxResult===0||!(ajaxResult instanceof Array)){outputBuffer[0]=2;}else{if(ajaxResult[0]===true){outputBuffer=[4,ajaxResult];}else{outputBuffer=[3,ajaxResult];}}}}).fail(function(data,a,message){if(data.status===0){wp_lib_error('Unable to connect to '+wp_lib_vars.siteName+'. Check your internet connection.');}else{wp_lib_error('HTTP Error '+data.status+': '+message);}
if(wp_lib_vars.debugMode){if(data.responseText!=''){console.log(jQuery(data.responseText).text());}}else{console.log('Please temporarily enable debugging mode to investigate the error https://github.com/kittsville/WP-Librarian/wiki/wp_lib_debug_mode');console.log("Unless it's an HTTP error that has nothing to do with WP-Librarian");}
outputBuffer[0]=0;}).always(function(){if(typeof postCallFunction==='function'){postCallFunction(outputBuffer);}
if(outputBuffer[0]>=3){wp_lib_scripts.Notifications.displayNotifications(outputBuffer[1][1]);}});}
function wp_lib_init_object(pageItem){elementObject={};jQuery(['id','name','value','html','title','href']).each(function(i,e){if(e in pageItem){elementObject[e]=pageItem[e];}});return elementObject;}
jQuery(function($){wp_lib_scripts.Notifications={s:{notificationsWrapper:$('#wp-lib-notifications'),},init:function(){this.bindUIActions();},bindUIActions:function(){wp_lib_scripts.Notifications.s.notificationsWrapper.on('click','div',function(event){wp_lib_scripts.Notifications.hideNotification(jQuery(event.currentTarget));});},displayNotification:function(notification){var classes,message,consoleMessage,notificationElement,uID=Math.random().toString().substring(2,8);if(notification[0]==0){classes='wp-lib-notification updated';message=notification[1];}
else if(notification[0]==1){classes='wp-lib-error error';consoleMessage='WP-Librarian Error: '+notification[1];message='<strong style="color: red;">'+consoleMessage+'</strong>';}else{classes='wp-lib-error error';consoleMessage='WP-Librarian Error '+notification[0]+': '+notification[1];message='<strong style="color: red;">'+consoleMessage+'</strong>';}
classes+=' notification-'+notification[0];notificationElement=$('<div id="'+uID+'" class="'+classes+'"><p>'+message+'</p></div>');if(notification[0]!=0&&typeof console!=='undefined'){console.log(consoleMessage);}
var displayTime=Math.min(Math.max(notification[1].length*150,3500),9000);notificationElement.appendTo(wp_lib_scripts.Notifications.s.notificationsWrapper).hide().fadeIn();setTimeout(function(){wp_lib_scripts.Notifications.hideNotification(notificationElement);},displayTime);},displayNotifications:function(notifications){notifications.forEach(function(notification){wp_lib_scripts.Notifications.displayNotification(notification);});},hideNotification:function(notificationElement){notificationElement.fadeOut("fast");notificationElement.remove();},};wp_lib_scripts.Notifications.init();});
