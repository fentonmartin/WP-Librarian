/*
 * jQuery Dynatable plugin 0.3.1
 *
 * Copyright (c) 2014 Steve Schwartz (JangoSteve)
 *
 * Dual licensed under the AGPL and Proprietary licenses:
 *   http://www.dynatable.com/license/
 *
 * Date: Tue Jan 02 2014
 */
(function(a){var b,c,d,e,f={dom:p,domColumns:q,records:r,recordsCount:s,processingIndicator:t,state:u,sorts:v,sortsHeaders:w,queries:x,inputsSearch:y,paginationPage:z,paginationPerPage:A,paginationLinks:B},g,h,i,j,k,l,m,n;b={features:{paginate:true,sort:true,pushState:true,search:true,recordCount:true,perPageSelect:true},table:{defaultColumnIdStyle:'camelCase',columns:null,headRowSelector:'thead tr',bodyRowSelector:'tbody tr',headRowClass:null},inputs:{queries:null,sorts:null,multisort:['ctrlKey','shiftKey','metaKey'],page:null,queryEvent:'blur change',recordCountTarget:null,recordCountPlacement:'after',paginationLinkTarget:null,paginationLinkPlacement:'after',paginationClass:'dynatable-pagination-links',paginationLinkClass:'dynatable-page-link',paginationPrevClass:'dynatable-page-prev',paginationNextClass:'dynatable-page-next',paginationActiveClass:'dynatable-active-page',paginationDisabledClass:'dynatable-disabled-page',paginationPrev:'Previous',paginationNext:'Next',paginationGap:[1,2,2,1],searchTarget:null,searchPlacement:'before',perPageTarget:null,perPagePlacement:'before',perPageText:'Show: ',recordCountText:'Showing ',processingText:'Processing...'},dataset:{ajax:false,ajaxUrl:null,ajaxCache:null,ajaxOnLoad:false,ajaxMethod:'GET',ajaxDataType:'json',totalRecordCount:null,queries:{},queryRecordCount:null,page:null,perPageDefault:10,perPageOptions:[10,20,50,100],sorts:{},sortsKeys:null,sortTypes:{},records:null},writers:{_rowWriter:k,_cellWriter:l,_attributeWriter:m},readers:{_rowReader:null,_attributeReader:n},params:{dynatable:'dynatable',queries:'queries',sorts:'sorts',page:'page',perPage:'perPage',offset:'offset',records:'records',record:null,queryRecordCount:'queryRecordCount',totalRecordCount:'totalRecordCount'}};d={init:function(b,d){this.settings=c(d);this.element=b;this.$element=a(b);h.call(this);return this;},process:function(a){i.call(this,a);}};c=function(c){var d=a.extend(true,{},b,c);if(c){if(c.inputs){if(c.inputs.multisort)d.inputs.multisort=c.inputs.multisort;if(c.inputs.paginationGap)d.inputs.paginationGap=c.inputs.paginationGap;}if(c.dataset&&c.dataset.perPageOptions)d.dataset.perPageOptions=c.dataset.perPageOptions;}return d;};h=function(){this.$element.trigger('dynatable:preinit',this);for(model in f)if(f.hasOwnProperty(model)){var a=this[model]=new f[model](this,this.settings);if(a.initOnLoad())a.init();}this.$element.trigger('dynatable:init',this);if(!this.settings.dataset.ajax||(this.settings.dataset.ajax&&this.settings.dataset.ajaxOnLoad)||this.settings.features.paginate)this.process();};i=function(b){var c={};this.$element.trigger('dynatable:beforeProcess',c);if(!a.isEmptyObject(this.settings.dataset.queries))c[this.settings.params.queries]=this.settings.dataset.queries;this.processingIndicator.show();if(this.settings.features.sort&&!a.isEmptyObject(this.settings.dataset.sorts))c[this.settings.params.sorts]=this.settings.dataset.sorts;if(this.settings.features.paginate&&this.settings.dataset.page){var d=this.settings.dataset.page,e=this.settings.dataset.perPage;c[this.settings.params.page]=d;c[this.settings.params.perPage]=e;c[this.settings.params.offset]=(d-1)*e;}if(this.settings.dataset.ajaxData)a.extend(c,this.settings.dataset.ajaxData);if(this.settings.dataset.ajax){var f=this;var h={type:f.settings.dataset.ajaxMethod,dataType:f.settings.dataset.ajaxDataType,data:c,error:function(a,b){},success:function(a){f.$element.trigger('dynatable:ajax:success',a);f.records.updateFromJson(a);f.dom.update();if(!b&&f.state.initOnLoad())f.state.push(c);},complete:function(){f.processingIndicator.hide();}};if(this.settings.dataset.ajaxUrl)h.url=this.settings.dataset.ajaxUrl;else h.url=g.refreshQueryString(window.location.href,{},this.settings);if(this.settings.dataset.ajaxCache!==null)h.cache=this.settings.dataset.ajaxCache;a.ajax(h);}else{this.records.resetOriginal();this.queries.run();if(this.settings.features.sort)this.records.sort();if(this.settings.features.paginate)this.records.paginate();this.dom.update();this.processingIndicator.hide();if(!b&&this.state.initOnLoad())this.state.push(c);}this.$element.trigger('dynatable:afterProcess',c);};function k(a,b,c,d){var e='';for(var f=0,g=c.length;f<g;f++)e+=d(c[f],b);return '<tr>'+e+'</tr>';};function l(a,b){var c=a.attributeWriter(b),d='<td';if(a.hidden||a.textAlign){d+=' style="';if(a.hidden)d+='display: none;';if(a.textAlign)d+='text-align: '+a.textAlign+';';d+='"';}return d+'>'+c+'</td>';};function m(a){return a[this.id];};function n(b,c){return a(b).html();};e={initOnLoad:function(){return true;},init:function(){}};for(model in f)if(f.hasOwnProperty(model)){var o=f[model];o.prototype=e;}function p(b,c){var d=this;this.update=function(){var d='',e=c.table.columns,f=c.writers._rowWriter,h=c.writers._cellWriter;b.$element.trigger('dynatable:beforeUpdate',d);for(var i=0,j=c.dataset.records.length;i<j;i++){var k=c.dataset.records[i],l=f(i,k,e,h);d+=l;}if(c.features.recordCount)a('#dynatable-record-count-'+b.element.id).replaceWith(b.recordsCount.create());if(c.features.paginate){a('#dynatable-pagination-links-'+b.element.id).replaceWith(b.paginationLinks.create());if(c.features.perPageSelect)a('#dynatable-per-page-'+b.element.id).val(parseInt(c.dataset.perPage));}if(c.features.sort&&e){b.sortsHeaders.removeAllArrows();for(var i=0,j=e.length;i<j;i++){var m=e[i],n=g.allMatch(c.dataset.sorts,m.sorts,function(a,b){return b in a;}),o=c.dataset.sorts[m.sorts[0]];if(n)b.$element.find('[data-dynatable-column="'+m.id+'"]').find('.dynatable-sort-header').each(function(){if(o==1)b.sortsHeaders.appendArrowUp(a(this));else b.sortsHeaders.appendArrowDown(a(this));});}}if(c.inputs.queries||c.features.search){var p=c.inputs.queries||a();if(c.features.search)p=p.add('#dynatable-query-search-'+b.element.id);p.each(function(){var b=a(this),d=c.dataset.queries[b.data('dynatable-query')];b.val(d||'');});}b.$element.find(c.table.bodyRowSelector).remove();b.$element.append(d);b.$element.trigger('dynatable:afterUpdate',d);};};function q(b,c){var e=this;this.initOnLoad=function(){return b.$element.is('table');};this.init=function(){c.table.columns=[];this.getFromTable();};this.getFromTable=function(){var d=b.$element.find(c.table.headRowSelector).children('th,td');if(d.length)d.each(function(b){e.add(a(this),b,true);});else return a.error("Couldn't find any columns headers in '"+c.table.headRowSelector+" th,td'. If your header row is different, specify the selector in the table: headRowSelector option.");};this.add=function(e,f,h,i){var j=c.table.columns,k=e.text(),l=e.data('dynatable-column')||g.normalizeText(k,c.table.defaultColumnIdStyle),m=e.data('dynatable-sorts'),n=m?a.map(m.split(','),function(b){return a.trim(b);}):[l];if(!l){this.generate(e);l=e.data('dynatable-column');}j.splice(f,0,{index:f,label:k,id:l,attributeWriter:c.writers[l]||c.writers._attributeWriter,attributeReader:c.readers[l]||c.readers._attributeReader,sorts:n,hidden:e.css('display')==='none',textAlign:e.css('text-align')});e.attr('data-dynatable-column',l).addClass('dynatable-head');if(c.table.headRowClass)e.addClass(c.table.headRowClass);if(!h){var o=f+1,p=b.$element.find(c.table.headRowSelector).children('th:nth-child('+o+'),td:nth-child('+o+')').first(),q=j.slice(f+1,j.length);if(p.length)p.before(e);else b.$element.find(c.table.headRowSelector).append(e);b.sortsHeaders.attachOne(e.get());if(q.length)for(var r=0,s=q.length;r<s;r++)q[r].index+=1;if(!i)b.dom.update();}return d;};this.remove=function(a){var d=c.table.columns,e=d.length;if(typeof a==="number"){var f=d[a];this.removeFromTable(f.id);this.removeFromArray(a);}else for(var g=d.length-1;g>=0;g--){var f=d[g];if(f.id===a){this.removeFromTable(a);this.removeFromArray(g);}}b.dom.update();};this.removeFromTable=function(a){b.$element.find(c.table.headRowSelector).children('[data-dynatable-column="'+a+'"]').first().remove();};this.removeFromArray=function(a){var b=c.table.columns,d;b.splice(a,1);d=b.slice(a,b.length);for(var e=0,f=d.length;e<f;e++)d[e].index-=1;};this.generate=function(b){var c=b===undefined?a('<th></th>'):b;return this.attachGeneratedAttributes(c);};this.attachGeneratedAttributes=function(a){var d=b.$element.find(c.table.headRowSelector).children('th[data-dynatable-generated]').length;return a.attr('data-dynatable-column','dynatable-generated-'+d).attr('data-dynatable-no-sort','true').attr('data-dynatable-generated',d);};};function r(b,c){var d=this;this.initOnLoad=function(){return !c.dataset.ajax;};this.init=function(){if(c.dataset.records===null){c.dataset.records=this.getFromTable();if(!c.dataset.queryRecordCount)c.dataset.queryRecordCount=this.count();if(!c.dataset.totalRecordCount)c.dataset.totalRecordCount=c.dataset.queryRecordCount;}c.dataset.originalRecords=a.extend(true,[],c.dataset.records);};this.updateFromJson=function(a){var b;if(c.params.records==="_root")b=a;else if(c.params.records in a)b=a[c.params.records];if(c.params.record){var d=b.length-1;for(var e=0;e<d;e++)b[e]=b[e][c.params.record];}if(c.params.queryRecordCount in a)c.dataset.queryRecordCount=a[c.params.queryRecordCount];if(c.params.totalRecordCount in a)c.dataset.totalRecordCount=a[c.params.totalRecordCount];c.dataset.records=b;};this.sort=function(){var d=[].sort,e=c.dataset.sorts,f=c.dataset.sortsKeys,g=c.dataset.sortTypes;var h=function(c,d){var h;if(a.isEmptyObject(e))h=b.sorts.functions.originalPlacement(c,d);else for(var i=0,j=f.length;i<j;i++){var k=f[i],l=e[k],m=g[k]||b.sorts.guessType(c,d,k);h=b.sorts.functions[m](c,d,k,l);if(h!==0)break;}return h;};return d.call(c.dataset.records,h);};this.paginate=function(){var a=this.pageBounds(),b=a[0],d=a[1];c.dataset.records=c.dataset.records.slice(b,d);};this.resetOriginal=function(){c.dataset.records=c.dataset.originalRecords||[];};this.pageBounds=function(){var a=c.dataset.page||1,b=(a-1)*c.dataset.perPage,d=Math.min(b+c.dataset.perPage,c.dataset.queryRecordCount);return [b,d];};this.getFromTable=function(){var d=[],e=c.table.columns,f=b.$element.find(c.table.bodyRowSelector);f.each(function(f){var g={};g['dynatable-original-index']=f;a(this).find('th,td').each(function(c){if(e[c]===undefined)b.domColumns.add(b.domColumns.generate(),e.length,false,true);var d=e[c].attributeReader(this,g),f=e[c].id;if(typeof d==="string"&&d.match(/\s*\<.+\>/)){if(!g['dynatable-sortable-text'])g['dynatable-sortable-text']={};g['dynatable-sortable-text'][f]=a.trim(a('<div></div>').html(d).text());}g[f]=d;});if(typeof (c.readers._rowReader)==="function")c.readers._rowReader(f,this,g);d.push(g);});return d;};this.count=function(){return c.dataset.records.length;};};function s(b,c){this.initOnLoad=function(){return c.features.recordCount;};this.init=function(){this.attach();};this.create=function(){var d=b.records.count(),e=c.dataset.queryRecordCount,f=c.dataset.totalRecordCount,g=c.inputs.recordCountText,h=c.params.records;if(d<e&&c.features.paginate){var i=b.records.pageBounds();g+="<span class='dynatable-record-bounds'>"+(i[0]+1)+" to "+i[1]+"</span> of ";}else if(d===e&&c.features.paginate)g+=d+" of ";g+=e+" "+h;if(e<f)g+=" (filtered from "+f+" total records)";return a('<span></span>',{id:'dynatable-record-count-'+b.element.id,'class':'dynatable-record-count',html:g});};this.attach=function(){var d=c.inputs.recordCountTarget?a(c.inputs.recordCountTarget):b.$element;d[c.inputs.recordCountPlacement](this.create());};};function t(b,c){this.init=function(){this.attach();};this.create=function(){var d=a('<div></div>',{html:'<span>'+c.inputs.processingText+'</span>',id:'dynatable-processing-'+b.element.id,'class':'dynatable-processing',style:'position: absolute; display: none;'});return d;};this.position=function(){var c=a('#dynatable-processing-'+b.element.id),d=c.children('span'),e=d.outerHeight(),f=d.outerWidth(),g=b.$element,h=g.offset(),i=g.outerHeight(),j=g.outerWidth();c.offset({left:h.left,top:h.top}).width(j).height(i);d.offset({left:h.left+((j-f)/2),top:h.top+((i-e)/2)});return c;};this.attach=function(){b.$element.before(this.create());};this.show=function(){a('#dynatable-processing-'+b.element.id).show();this.position();};this.hide=function(){a('#dynatable-processing-'+b.element.id).hide();};};function u(b,c){this.initOnLoad=function(){return c.features.pushState&&history.pushState;};this.init=function(){window.onpopstate=function(a){if(a.state&&a.state.dynatable)b.state.pop(a);};};this.push=function(d){var e=window.location.search,f,h,i,j,k,l,m,n=!(window.history.state&&window.history.state.dynatable),o=n?'replaceState':'pushState';if(e&&/^\?/.test(e))e=e.substring(1);a.extend(f,d);i=g.refreshQueryString(e,d,c);if(i)i='?'+i;j=window.location.hash;h=window.location.pathname;b.$element.trigger('dynatable:push',d);m={dynatable:{dataset:c.dataset}};if(!n)m.dynatable.scrollTop=a(window).scrollTop();l=JSON.stringify(m);m.dynatable.dataset.perPageOptions=a.makeArray(m.dynatable.dataset.perPageOptions);try{window.history[o](m,"Dynatable state",h+i+j);}catch(p){m.dynatable.dataset.records=null;window.history[o](m,"Dynatable state",h+i+j);}};this.pop=function(d){var e=d.state.dynatable;c.dataset=e.dataset;if(e.scrollTop)a(window).scrollTop(e.scrollTop);if(e.dataset.records)b.dom.update();else b.process(true);};};function v(b,c){this.initOnLoad=function(){return c.features.sort;};this.init=function(){var a=window.location.search.match(new RegExp(c.params.sorts+'[^&=]*=[^&]*','g'));c.dataset.sorts=a?g.deserialize(a)[c.params.sorts]:{};c.dataset.sortsKeys=a?g.keysFromObject(c.dataset.sorts):[];};this.add=function(b,e){var f=c.dataset.sortsKeys,g=a.inArray(b,f);c.dataset.sorts[b]=e;if(g===-1)f.push(b);return d;};this.remove=function(b){var e=c.dataset.sortsKeys,f=a.inArray(b,e);delete c.dataset.sorts[b];if(f!==-1)e.splice(f,1);return d;};this.clear=function(){c.dataset.sorts={};c.dataset.sortsKeys.length=0;};this.guessType=function(a,b,c){var d={string:'string',number:'number','boolean':'number',object:'number'},e=a[c]?typeof a[c]:typeof b[c],f=d[e]||'number';return f;};this.functions={number:function(a,b,c,d){return a[c]===b[c]?0:(d>0?a[c]-b[c]:b[c]-a[c]);},string:function(a,b,c,d){var e=(a['dynatable-sortable-text']&&a['dynatable-sortable-text'][c])?a['dynatable-sortable-text'][c]:a[c],f=(b['dynatable-sortable-text']&&b['dynatable-sortable-text'][c])?b['dynatable-sortable-text'][c]:b[c],g;e=e.toLowerCase();f=f.toLowerCase();g=e===f?0:(d>0?e>f:f>e);return g===false?-1:(g-0);},originalPlacement:function(a,b){return a['dynatable-original-index']-b['dynatable-original-index'];}};};function w(b,c){var d=this;this.initOnLoad=function(){return c.features.sort;};this.init=function(){this.attach();};this.create=function(e){var f=a(e),h=a('<a></a>',{'class':'dynatable-sort-header',href:'#',html:f.html()}),i=f.data('dynatable-column'),j=g.findObjectInArray(c.table.columns,{id:i});h.bind('click',function(a){d.toggleSort(a,h,j);b.process();a.preventDefault();});if(this.sortedByColumn(h,j))if(this.sortedByColumnValue(j)==1)this.appendArrowUp(h);else this.appendArrowDown(h);return h;};this.removeAll=function(){b.$element.find(c.table.headRowSelector).children('th,td').each(function(){d.removeAllArrows();d.removeOne(this);});};this.removeOne=function(b){var c=a(b),d=c.find('.dynatable-sort-header');if(d.length){var e=d.html();d.remove();c.html(c.html()+e);}};this.attach=function(){b.$element.find(c.table.headRowSelector).children('th,td').each(function(){d.attachOne(this);});};this.attachOne=function(b){var c=a(b);if(!c.data('dynatable-no-sort'))c.html(this.create(b));};this.appendArrowUp=function(a){this.removeArrow(a);a.append("<span class='dynatable-arrow'> &#9650;</span>");};this.appendArrowDown=function(a){this.removeArrow(a);a.append("<span class='dynatable-arrow'> &#9660;</span>");};this.removeArrow=function(a){a.find('.dynatable-arrow').remove();};this.removeAllArrows=function(){b.$element.find('.dynatable-arrow').remove();};this.toggleSort=function(a,d,e){var f=this.sortedByColumn(d,e),h=this.sortedByColumnValue(e);if(!c.inputs.multisort||!g.anyMatch(a,c.inputs.multisort,function(b,c){return a[c];})){this.removeAllArrows();b.sorts.clear();}if(f)if(h==1){for(var i=0,j=e.sorts.length;i<j;i++)b.sorts.add(e.sorts[i],-1);this.appendArrowDown(d);}else{for(var i=0,j=e.sorts.length;i<j;i++)b.sorts.remove(e.sorts[i]);this.removeArrow(d);}else{for(var i=0,j=e.sorts.length;i<j;i++)b.sorts.add(e.sorts[i],1);this.appendArrowUp(d);}};this.sortedByColumn=function(a,b){return g.allMatch(c.dataset.sorts,b.sorts,function(a,b){return b in a;});};this.sortedByColumnValue=function(a){return c.dataset.sorts[a.sorts[0]];};};function x(b,c){var e=this;this.initOnLoad=function(){return c.inputs.queries||c.features.search;};this.init=function(){var a=window.location.search.match(new RegExp(c.params.queries+'[^&=]*=[^&]*','g'));c.dataset.queries=a?g.deserialize(a)[c.params.queries]:{};if(c.dataset.queries==="")c.dataset.queries={};if(c.inputs.queries)this.setupInputs();};this.add=function(a,b){if(c.features.paginate)c.dataset.page=1;c.dataset.queries[a]=b;return d;};this.remove=function(a){delete c.dataset.queries[a];return d;};this.run=function(){for(query in c.dataset.queries)if(c.dataset.queries.hasOwnProperty(query)){var d=c.dataset.queries[query];if(e.functions[query]===undefined){var f=g.findObjectInArray(c.table.columns,{id:query});if(f)e.functions[query]=function(a,b){return a[query]==b;};else{a.error("Query named '"+query+"' called, but not defined in queries.functions");continue;}}c.dataset.records=a.map(c.dataset.records,function(a){return e.functions[query](a,d)?a:null;});}c.dataset.queryRecordCount=b.records.count();};this.runSearch=function(d){var e=a.extend({},c.dataset.queries);if(d)this.add('search',d);else this.remove('search');if(!g.objectsEqual(c.dataset.queries,e))b.process();};this.setupInputs=function(){c.inputs.queries.each(function(){var d=a(this),f=d.data('dynatable-query-event')||c.inputs.queryEvent,g=d.data('dynatable-query')||d.attr('name')||this.id,h=function(d){var f=a(this).val();if(f==="")f=undefined;if(f===c.dataset.queries[g])return false;if(f)e.add(g,f);else e.remove(g);b.process();d.preventDefault();};d.attr('data-dynatable-query',g).bind(f,h).bind('keypress',function(a){if(a.which==13)h.call(this,a);});if(c.dataset.queries[g])d.val(decodeURIComponent(c.dataset.queries[g]));});};this.functions={search:function(a,b){var c=false;for(attr in a)if(a.hasOwnProperty(attr)){var d=a[attr];if(typeof d==="string"&&d.toLowerCase().indexOf(b.toLowerCase())!==-1){c=true;break;}else continue;}return c;}};};function y(b,c){var d=this;this.initOnLoad=function(){return c.features.search;};this.init=function(){this.attach();};this.create=function(){var d=a('<input />',{type:'search',id:'dynatable-query-search-'+b.element.id,'data-dynatable-query':'search',value:c.dataset.queries.search}),e=a('<span></span>',{id:'dynatable-search-'+b.element.id,'class':'dynatable-search',text:'Search: '}).append(d);d.bind(c.inputs.queryEvent,function(){b.queries.runSearch(a(this).val());}).bind('keypress',function(c){if(c.which==13){b.queries.runSearch(a(this).val());c.preventDefault();}});return e;};this.attach=function(){var d=c.inputs.searchTarget?a(c.inputs.searchTarget):b.$element;d[c.inputs.searchPlacement](this.create());};};function z(a,b){this.initOnLoad=function(){return b.features.paginate;};this.init=function(){var a=window.location.search.match(new RegExp(b.params.page+'=([^&]*)'));if(a&&b.features.pushState)this.set(a[1]);else this.set(1);};this.set=function(a){b.dataset.page=parseInt(a,10);};};function A(b,c){var d=this;this.initOnLoad=function(){return c.features.paginate;};this.init=function(){var a=window.location.search.match(new RegExp(c.params.perPage+'=([^&]*)'));if(a&&c.features.pushState)this.set(a[1],true);else this.set(c.dataset.perPageDefault,true);if(c.features.perPageSelect)this.attach();};this.create=function(){var e=a('<select>',{id:'dynatable-per-page-'+b.element.id,'class':'dynatable-per-page-select'});for(var f=0,g=c.dataset.perPageOptions.length;f<g;f++){var h=c.dataset.perPageOptions[f],i=c.dataset.perPage==h?'selected="selected"':'';e.append('<option value="'+h+'" '+i+'>'+h+'</option>');}e.bind('change',function(c){d.set(a(this).val());b.process();});return a('<span />',{'class':'dynatable-per-page'}).append("<span class='dynatable-per-page-label'>"+c.inputs.perPageText+"</span>").append(e);};this.attach=function(){var d=c.inputs.perPageTarget?a(c.inputs.perPageTarget):b.$element;d[c.inputs.perPagePlacement](this.create());};this.set=function(a,d){if(!d)b.paginationPage.set(1);c.dataset.perPage=parseInt(a);};};function B(b,c){var d=this;this.initOnLoad=function(){return c.features.paginate;};this.init=function(){this.attach();};this.create=function(){var d='<ul id="'+'dynatable-pagination-links-'+b.element.id+'" class="'+c.inputs.paginationClass+'">',e=c.inputs.paginationLinkClass,f=c.inputs.paginationActiveClass,g=c.inputs.paginationDisabledClass,h=Math.ceil(c.dataset.queryRecordCount/c.dataset.perPage),i=c.dataset.page,j=[c.inputs.paginationGap[0],c.dataset.page-c.inputs.paginationGap[1],c.dataset.page+c.inputs.paginationGap[2],(h+1)-c.inputs.paginationGap[3]];d+='<li><span>Pages: </span></li>';for(var k=1;k<=h;k++)if((k>j[0]&&k<j[1])||(k>j[2]&&k<j[3]))continue;else{var l=b.paginationLinks.buildLink(k,k,e,i==k,f),m,n;m=a.inArray(k,j);n=j[m+1];if(m>0&&k!==1&&n&&n>(k+1)){var o='<li><span class="dynatable-page-break">&hellip;</span></li>';l=m<2?o+l:l+o;}if(c.inputs.paginationPrev&&k===1){var p=b.paginationLinks.buildLink(i-1,c.inputs.paginationPrev,e+' '+c.inputs.paginationPrevClass,i===1,g);l=p+l;}if(c.inputs.paginationNext&&k===h){var q=b.paginationLinks.buildLink(i+1,c.inputs.paginationNext,e+' '+c.inputs.paginationNextClass,i===h,g);l+=q;}d+=l;}d+='</ul>';var r='#dynatable-pagination-links-'+b.element.id+' a.'+e+':not(.'+f+',.'+g+')';a(document).undelegate(r,'click.dynatable');a(document).delegate(r,'click.dynatable',function(d){$this=a(this);$this.closest(c.inputs.paginationClass).find('.'+f).removeClass(f);$this.addClass(f);b.paginationPage.set($this.data('dynatable-page'));b.process();d.preventDefault();});return d;};this.buildLink=function(a,b,c,d,e){var f='<a data-dynatable-page='+a+' class="'+c,g='<li';if(d){f+=' '+e;g+=' class="'+e+'"';}f+='">'+b+'</a>';g+='>'+f+'</li>';return g;};this.attach=function(){var d=c.inputs.paginationLinkTarget?a(c.inputs.paginationLinkTarget):b.$element;d[c.inputs.paginationLinkPlacement](b.paginationLinks.create());};};g=d.utility={normalizeText:function(a,b){a=this.textTransform[b](a);return a;},textTransform:{trimDash:function(a){return a.replace(/^\s+|\s+$/g,"").replace(/\s+/g,"-");},camelCase:function(a){a=this.trimDash(a);return a.replace(/(\-[a-zA-Z])/g,function(a){return a.toUpperCase().replace('-','');}).replace(/([A-Z])([A-Z]+)/g,function(a,b,c){return b+c.toLowerCase();}).replace(/^[A-Z]/,function(a){return a.toLowerCase();});},dashed:function(a){a=this.trimDash(a);return this.lowercase(a);},underscore:function(a){a=this.trimDash(a);return this.lowercase(a.replace(/(-)/g,'_'));},lowercase:function(a){return a.replace(/([A-Z])/g,function(a){return a.toLowerCase();});}},deserialize:function(b){if(!b)return{};if(typeof b==="object")b=b.join('&');var c={},d=b.split("&");for(var e=0;e<d.length;e++){var f=d[e].split("="),g=decodeURIComponent(f[0]),h,i;if(!f[1])continue;;h=decodeURIComponent(f[1].replace(/\+/g,' '));while(i=g.match(/([^&=]+)\[([^&=]+)\]$/)){var j=h;g=i[1];h={};if(i[2].substr(i[2].length-2)=='][')h[i[2].substr(0,i[2].length-2)]=[j];else h[i[2]]=j;}if(typeof c[g]==="undefined")if(g.substr(g.length-2)!='[]')c[g]=h;else c[g]=[h];else if(typeof c[g]==="string")c[g]=h;else if(typeof c[g]==="object")c[g]=a.extend({},c[g],h);else c[g].push(h);}return c;},refreshQueryString:function(b,c,d){var e=this,f=b.split('?'),g=f.shift(),h;h=this.deserialize(b);for(n in d.params)if(d.params.hasOwnProperty(n)){var i=d.params[n];if((!d.features.sort&&n=="sorts")||(!d.features.paginate&&e.anyMatch(n,["page","perPage","offset"],function(a,b){return a==b;})))continue;if((n==="page"||n==="offset")&&c.page===1){if(h[i])delete h[i];continue;}if(n==="perPage"&&c[i]==d.dataset.perPageDefault){if(h[i])delete h[i];continue;}if(n=="queries"&&c[i]){var j=d.inputs.queries||[],k=a.makeArray(j.map(function(){return a(this).attr('name');}));if(d.features.search)k.push('search');for(var l=0,m=k.length;l<m;l++){var n=k[l];if(c[i][n]){if(typeof h[i]==='undefined')h[i]={};h[i][n]=c[i][n];}else delete h[i][n];}continue;}if(c[i])h[i]=c[i];else delete h[i];}return decodeURI(a.param(h));},keysFromObject:function(a){var b=[];for(var c in a)b.push(c);return b;},findObjectInArray:function(a,b){var c=this,d;for(var e=0,f=a.length;e<f;e++){var g=a[e];if(c.allMatch(g,b,function(a,b,c){return a[b]==c;})){d=g;break;}}return d;},allMatch:function(b,c,d){var e=true,f=a.isArray(c);a.each(c,function(a,c){var g=f?d(b,c):d(b,a,c);if(!g)return e=false;});return e;},anyMatch:function(b,c,d){var e=false,f=a.isArray(c);a.each(c,function(a,c){var g=f?d(b,c):d(b,a,c);if(g){e=true;return false;}});return e;},objectsEqual:function(a,b){for(attr in a)if(a.hasOwnProperty(attr))if(!b.hasOwnProperty(attr)||a[attr]!==b[attr])return false;for(attr in b)if(b.hasOwnProperty(attr)&&!a.hasOwnProperty(attr))return false;return true;},randomHash:function(){return(((1+Math.random())*0x10000)|0).toString(16).substring(1);}};if(typeof Object.create!=="function")Object.create=function(a){function b(){}b.prototype=a;return new b();};a.dynatableSetup=function(a){b=c(a);};a.dynatable=function(b){a.fn.dynatable=function(c){return this.each(function(){if(!a.data(this,'dynatable'))a.data(this,'dynatable',Object.create(b).init(this,c));});};};a.dynatable(d);})(jQuery);